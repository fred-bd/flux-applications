apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: kubernetes-dashboard
spec:
  interval: 10m
  timeout: 5m
  targetNamespace: kube-dashboard
  releaseName: kubernetes-dashboard
  chart:
    spec:
      chart: kubernetes-dashboard
      version: 7.x
      sourceRef:
        kind: HelmRepository
        name: local-helm-repo
      interval: 1m
  install:
    crds: CreateReplace
    createNamespace: true
  upgrade:
    crds: CreateReplace
  values:
    app:
      ingress:
        enabled: true
        ingressClassName: nginx
        hosts:
        - ${domain}
        path: "/dashboard(/|$)(.*)"
        issuer:
          name: ${cert_issuer_name}
          scope: cluster
        tls:
          enabled: true
          secretName: tls-cert
        annotations:
          nginx.ingress.kubernetes.io/service-upstream: "true"
    extras:
      manifests:
      - apiVersion: v1
        kind: ServiceAccount
        metadata:
          name: admin-user
          namespace: kube-dashboard
      - apiVersion: rbac.authorization.k8s.io/v1
        kind: ClusterRoleBinding
        metadata:
          name: admin-user
        roleRef:
          apiGroup: rbac.authorization.k8s.io
          kind: ClusterRole
          name: cluster-admin
        subjects:
        - kind: ServiceAccount
          name: admin-user
          namespace: kube-dashboard
    # kong:
    #   enabled: false
    # auth:
    #   containers:
    #     args:
    #       - "--enable-skip-login"